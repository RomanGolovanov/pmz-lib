!function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return o(n?n:t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";e.exports.PmzModel=t("./model/model"),e.exports.PmzModelFile=t("./storage/model-file")},{"./model/model":8,"./storage/model-file":13}],2:[function(t,e,n){"use strict";function r(t,e){return this.x=t,this.y=e,this}r.prototype.isEmpty=function(){return 0===this.x&&0===this.y},e.exports=r},{}],3:[function(t,e,n){"use strict";function r(t,e,n,r){return this.x=t,this.y=e,this.width=n,this.height=r,this}r.prototype.isEmpty=function(){return 0===this.x&&0===this.y&&0===this.width&&0===this.height},e.exports=r},{}],4:[function(t,e,n){"use strict";function r(t,e){return this.minutes=t,this.seconds=e,this}e.exports=r},{}],5:[function(t,e,n){(function(n){"use strict";function r(t){return t&&"?"!==t?parseInt(t):null}function o(t){return t?t.split(",").map(function(t){return"?"===t?null:t}):[]}function i(t){return o(t).map(function(t){return t?parseInt(t):null})}function s(t){return o(t).map(function(t){return t?parseFloat(t):null})}var a="undefined"!=typeof window?window.windows1251:"undefined"!=typeof n?n.windows1251:null,u=t("./point"),c=t("./rect"),f=t("./time");e.exports={constants:{DEFAULT_MAP_NAME:"Metro.map",DEFAULT_TRP_NAME:"Metro.trp",DEFAULT_LINE_COLOR:"black"},asArray:o,asIntArray:i,asFloatArray:s,asPmzPointArray:function(t){for(var e=i(t),n=[],r=0;r<e.length-1;r+=2)n.push(new u(e[r],e[r+1]));return n},asPmzRectArray:function(t){for(var e=i(t),n=[],r=0;r<e.length-3;r+=2)n.push(new c(e[r],e[r+1],e[r+2],e[r+3]));return n},asPmzPoint:function(t){var e=i(t);return new u(e[0],e[1])},asPmzRect:function(t){var e=i(t);return new c(e[0],e[1],e[2],e[3])},asAdditionalNodes:function(t){for(var e=o(t),n=e[0],r=e[1],i=e[2],s=e.length%2===0,a=[],c=3;c<e.length-1;c+=2)a.push(new u(parseInt(e[c]),parseInt(e[c+1])));return new PmzAdditionNodes(n,r,i,a,s)},asPmzTime:function(t){if(!t||!t.length)return null;var e=t.split(".");return new f(r(e[0]),2===e.length?r(e[1]):null)},asColor:function(t){return t&&t.length?"#"+t:null},decodeWindows1251:function(t){var e="";return t.forEach(function(t){e+=String.fromCharCode(t)}),a.decode(e,{mode:"fatal"})},encodeWindows1251:function(t){for(var e=a.encode(t),n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./point":2,"./rect":3,"./time":4}],6:[function(t,e,n){"use strict";function r(t,e,n,r,o){return this.line=t,this.src=e,this.dst=n,this.points=r,this.isSpline=o,this}e.exports=r},{}],7:[function(t,e,n){"use strict";function r(t,e,n,r,o,i,s){return this.name=t,this.cityName=e,this.countryName=n,this.version=r,this.description=o,this.comment=i,this.delays=s,this}e.exports=r},{}],8:[function(t,e,n){"use strict";function r(t){return this.metadata=t,this.transports={},this.schemes={},this}var o=t("./metadata"),i=t("./scheme"),s=t("./transport");r.create=function(){var t=new r(new o("Unknown",null,null,"1.0.0"));return t.addTransport("Metro.trp","Метро"),t.addScheme("Metro.map"),t},r.prototype.getMetadata=function(){return this.metadata},r.prototype.getSchemes=function(){return Object.keys(this.schemes)},r.prototype.addScheme=function(t,e,n){this.schemes[t]=new i(t,t,e||{},n||{})},r.prototype.removeScheme=function(t){delete this.schemes[t]},r.prototype.getScheme=function(t){return this.schemes[t]},r.prototype.getTransports=function(){return Object.keys(this.transports)},r.prototype.addTransport=function(t,e,n,r){this.transports[t]=new s(t,t,{type:e},n||{},r||{})},r.prototype.removeTransport=function(t){delete this.transports[t]},r.prototype.getTransport=function(t){return this.transports[t]},e.exports=r},{"./metadata":7,"./scheme":10,"./transport":11}],9:[function(t,e,n){"use strict";function r(t,e,n,r,o,i,s,a,u,c,f,l){return this.id=t,this.name=e,this.color=n,this.labelColor=r,this.labelBackgroundColor=o,this.coords=i||[],this.rects=s||[],this.heights=a||[],this.rect=u,this.rects2=c||[],this.nodes=f||[],this.visible=l,this}e.exports=r},{}],10:[function(t,e,n){"use strict";function r(t,e,n,r){return this.id=t,this.name=e,this.options=n,this.lines=r,this}e.exports=r},{}],11:[function(t,e,n){"use strict";function r(t,e,n,r,o){return this.id=t,this.name=e,this.options=n,this.lines=r,this.transfers=o,this}e.exports=r},{}],12:[function(t,e,n){"use strict";function r(t){var e=t.Options,n=(e.DelayNames||"").split("\n");return new i(e.Name,e.CityName,e.Country,e.NeedVersion,e.MapAuthors.reduce(function(t,e){return t+"\n"+e}),e.Comment,n)}function o(t){var e={Options:{Name:t.name,CityName:t.cityName||"Unknown",Country:t.countryName||"Unknown",NeedVersion:t.version||"1.0.0",MapAuthors:(t.description||"").split("\n")}};return t.comment&&(e.Options.Comment=t.comment),t.delays&&(e.Options.DelayNames=t.delays.reduce(function(t,e){return t+","+e})),e}var i=t("../model/metadata");e.exports.load=r,e.exports.save=o},{"../model/metadata":7}],13:[function(t,e,n){(function(n){"use strict";function r(t,e,n){for(var r in t.files){var o=t.files[r];if(r.endsWith(e)&&n(r,o))return}}function o(t,e,n){r(t,e,function(t,e){return n(t,c.parseIniText(c.decodeWindows1251(e.asUint8Array())))})}function i(t){if(-1==["application/x-zip-compressed","application/zip"].indexOf(t.type))throw new TypeError("Invalid file type "+t.type+" for PMZ map");var e=new u(t.content);return r(e,".pmz",function(t,n){return e=new u(n.asArrayBuffer()),!0}),e}function s(t){var e=i(t),n=null;if(o(e,".cty",function(t,e){n=new f(l.load(e))}),!n)throw new TypeError("Invalid file format");return o(e,".trp",function(t,e){var r=p.load(e,t,n.getMetadata());n.addTransport(r.name,r.options,r.lines,r.transfers)}),o(e,".map",function(t,e){var r=d.load(e,t,n);n.addScheme(r.name,r.options,r.lines)}),n}function a(t,e){var n=i(t),r=l.save(e.metadata),o=c.formatIniText(r),s=c.encodeWindows1251(o);n.file(e.metadata.name+".cty",s),t.content=n.generate({type:"arraybuffer"})}var u="undefined"!=typeof window?window.JSZip:"undefined"!=typeof n?n.JSZip:null,c=t("../common/utils"),f=t("../model/model"),l=t("./metadata-file"),p=t("./transport-file"),d=t("./scheme-file");e.exports.load=s,e.exports.save=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../common/utils":5,"../model/model":8,"./metadata-file":12,"./scheme-file":14,"./transport-file":15}],14:[function(t,e,n){"use strict";function r(t){for(var e=asArray(t),n=e[0],r=e[1],o=e[2],i=e.length%2===0,s=[],a=3;a<e.length-1;a+=2)s.push(new l(parseInt(e[a]),parseInt(e[a+1])));return new h(n,r,o,s,i)}function o(t){return t?{imageFileName:t.ImageFileName,stationDiameter:t.StationDiameter,lineWidth:t.LinesWidth,upperCase:t.UpperCase,wordWrap:t.WordWrap,isVector:t.IsVector,transports:f.asArray(t.Transports),checkedTransports:f.asArray(t.CheckedTransports)}:{}}function i(t){if(!t)return{};var e={};for(var n in t){var o=t[n],i=r(o);e[i.line]||(e[i.line]=[]),e[i.line].push(r(o))}return e}function s(t,e){var n={};for(var r in t){var o=t[r];n[r]=new d(r,r,f.asColor(o.Color),o.LabelsColor,o.LabelsBColor,f.asPmzPointArray(o.Coordinates),f.asPmzRectArray(o.Rects),f.asFloatArray(o.Heights),f.asPmzRect(o.Rect),f.asPmzRectArray(o.Rects2),e[r]||[],!0)}return n}function a(t,e){var n=[];e.getTransports().forEach(function(t){Array.prototype.push.apply(n,Object.keys(e.getTransport(t).lines))});var r={};for(var o in t)-1!==n.indexOf(o)&&(r[o]=t[o]);return r}function u(t,e,n){var r=o(t.Options),u=i(t.AdditionalNodes),c=s(a(t,n),u);return new p(e,e,r,c)}function c(){throw new TypeError("Not implemented")}var f=t("../common/utils"),l=t("../common/point"),p=t("../model/scheme"),d=t("../model/scheme-line"),h=t("../model/additional-nodes");e.exports.load=u,e.exports.save=c},{"../common/point":2,"../common/utils":5,"../model/additional-nodes":6,"../model/scheme":10,"../model/scheme-line":9}],15:[function(t,e,n){"use strict";(function(){function t(t){return{type:t.Type||"Метро"}}function e(t,e){var n={};for(var r in e){var o=e[r],i={};if(o.Delays)for(var s=o.Delays.split(","),a=0;a<t.length;a++)i[t[a]]=s[a];o.DelayDay&&(i.Day=o.DelayDay),o.DelayNight&&(i.Night=o.DelayNight),n[o.Name]={sectionName:r,lineMap:o.LineMap,stations:o.Stations,driving:o.Driving,delays:i}}return n}function n(t){return t}function r(t){var e={};for(var n in t)-1===["Options","Transfers","AdditionalInfo"].indexOf(n)&&(e[n]=t[n]);return e}return{load:function(o,i,s){return new PmzTransport(i,i,t(o.Options||{}),e(s.delays,r(o)),n(o.Transfers||{}))},save:function(){throw new TypeError("Not implemented")}}})()},{}]},{},[1]);
//# sourceMappingURL=pmz-lib.min.js.map
