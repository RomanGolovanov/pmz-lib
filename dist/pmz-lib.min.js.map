{"version":3,"sources":["pmz-lib.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","PmzModel","PmzModelFile","./model/model","./storage/model-file",2,"PmzPoint","x","y","this","prototype","isEmpty",3,"PmzRect","width","height",4,"PmzTime","minutes","seconds",5,"global","asInt","text","parseInt","asArray","split","map","item","asIntArray","asFloatArray","parseFloat","windows1251","window","constants","DEFAULT_MAP_NAME","DEFAULT_TRP_NAME","DEFAULT_LINE_COLOR","asPmzPointArray","values","points","push","asPmzRectArray","rects","asPmzPoint","asPmzRect","asAdditionalNodes","parts","line","src","dst","isSpline","PmzAdditionNodes","asPmzTime","asColor","decodeWindows1251","buffer","byteString","forEach","b","String","fromCharCode","decode","mode","encodeWindows1251","asciiEncodedText","encode","Uint8Array","charCodeAt","self","./point","./rect","./time",6,7,"PmzMetadata","name","cityName","countryName","version","description","comment","delays",8,"metadata","transports","schemes","PmzScheme","PmzTransport","create","model","addTransport","addScheme","getMetadata","getSchemes","Object","keys","options","lines","removeScheme","getScheme","getTransports","type","transfers","removeTransport","getTransport","./metadata","./scheme","./transport",9,"PmzSchemeLine","id","color","labelColor","labelBackgroundColor","coords","heights","rect","rects2","nodes","visible",10,11,12,"load","ini","Options","delayNames","Name","CityName","Country","NeedVersion","MapAuthors","reduce","c","save","Comment","DelayNames","../model/metadata",13,"enumerateEntries","zip","ext","callback","entryName","files","zipEntry","endsWith","enumerateIniEntries","entry","PmzUtils","parseIniText","asUint8Array","openZip","file","indexOf","TypeError","JSZip","content","asArrayBuffer","PmzMetadataFile","transport","PmzTransportFile","scheme","PmzSchemeFile","metaIni","metaText","formatIniText","metaEncoded","generate","../common/utils","../model/model","./metadata-file","./scheme-file","./transport-file",14,"loadMapOptions","imageFileName","stationDiameter","lineWidth","upperCase","wordWrap","isVector","checkedTransports","loadAdditionalNodes","lineNodes","key","node","loadMapLines","filterLineSections","lineNames","Array","apply","sections","additionalNodes","../common/point","../model/additional-nodes","../model/scheme","../model/scheme-line",15,"loadTrpOptions","loadTrpLines","cityDelays","delayValues","Delays","DelayDay","DelayNight","sectionName","lineMap","stations","driving","loadTrpTransfers","filterTrpLineSections"],"mappings":"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","file":"pmz-lib.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\r\n\r\nmodule.exports.PmzModel = require('./model/model');\r\n\r\nmodule.exports.PmzModelFile = require('./storage/model-file');\r\n\r\n\n},{\"./model/model\":8,\"./storage/model-file\":13}],2:[function(require,module,exports){\n'use strict';\r\n\r\nfunction PmzPoint(x,y){\r\n\tthis.x = x;\r\n\tthis.y = y;\r\n\treturn this;\r\n}\r\n\r\nPmzPoint.prototype.isEmpty = function(){\r\n\treturn this.x === 0 && this.y === 0;\r\n};\r\n\r\nmodule.exports = PmzPoint;\r\n\n},{}],3:[function(require,module,exports){\n'use strict';\r\n\r\nfunction PmzRect(x,y,width,height){\r\n\tthis.x = x;\r\n\tthis.y = y;\r\n\tthis.width = width;\r\n\tthis.height = height;\r\n\treturn this;\r\n}\r\n\r\nPmzRect.prototype.isEmpty = function(){\r\n\treturn this.x === 0 && this.y === 0 && this.width === 0 && this.height === 0;\r\n};\r\n\r\nmodule.exports = PmzRect;\r\n\n},{}],4:[function(require,module,exports){\n'use strict';\r\n\r\nfunction PmzTime(minutes, seconds){\r\n\tthis.minutes = minutes;\r\n\tthis.seconds = seconds;\r\n\treturn this;\r\n}\r\n\r\nmodule.exports = PmzTime;\r\n\n},{}],5:[function(require,module,exports){\n(function (global){\n'use strict';\r\n\r\nvar windows1251 = (typeof window !== \"undefined\" ? window['windows1251'] : typeof global !== \"undefined\" ? global['windows1251'] : null),\r\n\tPmzPoint = require('./point'),\r\n\tPmzRect = require('./rect'),\r\n\tPmzTime = require('./time');\r\n\r\nfunction asInt(text){\r\n\treturn text && text!=='?' ? parseInt(text) : null;\r\n}\r\n\r\nfunction asArray(text){\r\n\tif(!text) return [];\r\n\treturn text.split(',').map(function(item){ \r\n\t\treturn item === '?' ? null : item; \r\n\t});\r\n}\r\n\r\nfunction asIntArray(text){\r\n\treturn asArray(text).map(function(item){ \r\n\t\tif(!item) return null;\r\n\t\treturn parseInt(item); \r\n\t});\r\n}\r\n\r\nfunction asFloatArray(text){\r\n\treturn asArray(text).map(function(item){ \r\n\t\tif(!item) return null;\r\n\t\treturn parseFloat(item); \r\n\t});\r\n}\r\n\r\nmodule.exports = {\r\n    constants: {\r\n        DEFAULT_MAP_NAME: 'Metro.map',\r\n        DEFAULT_TRP_NAME: 'Metro.trp',\r\n        DEFAULT_LINE_COLOR: 'black'\r\n    },\r\n\r\n\tasArray: asArray,\r\n\r\n\tasIntArray: asIntArray,\r\n    \r\n\tasFloatArray: asFloatArray,\r\n\r\n\tasPmzPointArray: function(text){\r\n\t\tvar values = asIntArray(text);\r\n\t\tvar points = [];\r\n\t\tfor(var i =0; i<(values.length-1); i+=2){\r\n\t\t\tpoints.push(new PmzPoint(values[i],values[i+1]));\r\n\t\t}\r\n\t\treturn points;\r\n\t},\r\n\r\n\tasPmzRectArray: function(text){\r\n\t\tvar values = asIntArray(text);\r\n\t\tvar rects = [];\r\n\t\tfor(var i =0; i<(values.length-3); i+=2){\r\n\t\t\trects.push(new PmzRect(values[i],values[i+1],values[i+2],values[i+3]));\r\n\t\t}\r\n\t\treturn rects;\r\n\t},\r\n\r\n\tasPmzPoint: function(text){\r\n\t\tvar values = asIntArray(text);\r\n\t\treturn new PmzPoint(values[0],values[1]);\r\n\t},\r\n\r\n\tasPmzRect: function(text){\r\n\t\tvar values = asIntArray(text);\r\n\t\treturn new PmzRect(values[0],values[1],values[2],values[3]);\r\n\t},\r\n\r\n\tasAdditionalNodes: function(text){\r\n        var parts = asArray(text);\r\n\r\n        var line = parts[0];\r\n        var src = parts[1];\r\n        var dst = parts[2];\r\n        var isSpline = parts.length % 2 === 0;\r\n        var points = [];\r\n        for(var i=3;i<(parts.length-1); i+=2){\r\n        \tpoints.push(new PmzPoint(parseInt(parts[i]), parseInt(parts[i+1])));\r\n        }\r\n\t\treturn new PmzAdditionNodes(line, src, dst, points, isSpline);\r\n\t},\r\n\r\n\tasPmzTime: function(text){\r\n\t\tif(!text || !text.length){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tvar parts = text.split('.');\r\n\t\treturn new PmzTime(asInt(parts[0]), \r\n\t\t\tparts.length === 2 ? asInt(parts[1]) : null);\r\n\t},\r\n\r\n    asColor: function(text){\r\n        if(!text || !text.length){\r\n            return null;\r\n        }\r\n        return '#' + text;\r\n    },\r\n\r\n    decodeWindows1251 : function (buffer){\r\n        var byteString = '';\r\n        buffer.forEach(function(b){ \r\n            byteString = byteString + String.fromCharCode(b); \r\n        });\r\n        return windows1251.decode(byteString, { 'mode': 'fatal' });\r\n    },\r\n\r\n    encodeWindows1251 : function (text){\r\n        var asciiEncodedText = windows1251.encode(text);\r\n        var buffer = new Uint8Array(asciiEncodedText.length);\r\n        for(var i=0;i<asciiEncodedText.length;i++){\r\n            buffer[i] = asciiEncodedText.charCodeAt(i);\r\n        }\r\n        return buffer;\r\n    }\r\n\r\n};\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./point\":2,\"./rect\":3,\"./time\":4}],6:[function(require,module,exports){\n'use strict';\r\n\r\nfunction PmzAdditionNodes(line, src, dst, points, isSpline){\r\n\tthis.line = line;\r\n\tthis.src = src;\r\n\tthis.dst = dst;\r\n\tthis.points = points;\r\n\tthis.isSpline = isSpline;\r\n\treturn this;\r\n}\r\n\r\nmodule.exports = PmzAdditionNodes;\r\n\n},{}],7:[function(require,module,exports){\n'use strict';\r\n\r\nfunction PmzMetadata(name, cityName, countryName, version, description, comment, delays){\r\n\tvar self = this;\r\n\r\n\tthis.name = name;\r\n\tthis.cityName = cityName;\r\n\tthis.countryName = countryName;\r\n\tthis.version = version;\r\n\tthis.description = description;\r\n\tthis.comment = comment;\r\n\tthis.delays = delays;\r\n\r\n\treturn this;\r\n}\r\n\r\nmodule.exports = PmzMetadata;\r\n\n},{}],8:[function(require,module,exports){\n'use strict';\r\n\r\nvar PmzMetadata = require('./metadata'),\r\n\tPmzScheme = require('./scheme'),\r\n\tPmzTransport = require('./transport');\r\n\r\n\r\nfunction PmzModel(metadata){\r\n\tthis.metadata = metadata;\r\n\tthis.transports = {};\r\n\tthis.schemes = {};\r\n\treturn this;\r\n}\r\n\r\n\r\nPmzModel.create = function(){\r\n\tvar model = new PmzModel(new PmzMetadata('Unknown', null, null, '1.0.0'));\r\n\tmodel.addTransport('Metro.trp', 'Метро');\r\n\tmodel.addScheme('Metro.map');\r\n\treturn model;\r\n};\r\n\r\n\r\nPmzModel.prototype.getMetadata = function(){\r\n\treturn this.metadata;\r\n};\r\n\r\n\r\nPmzModel.prototype.getSchemes = function(){\r\n\treturn Object.keys(this.schemes);\r\n};\r\n\r\nPmzModel.prototype.addScheme = function(name, options, lines){\r\n\tthis.schemes[name] = new PmzScheme(name, name, options || {}, lines || {});\r\n};\r\n\r\nPmzModel.prototype.removeScheme = function(name){\r\n\tdelete this.schemes[name];\r\n};\r\n\r\nPmzModel.prototype.getScheme = function(name){\r\n\treturn this.schemes[name];\r\n};\r\n\r\n\r\nPmzModel.prototype.getTransports = function(){\r\n\treturn Object.keys(this.transports);\r\n};\r\n\r\nPmzModel.prototype.addTransport = function(name, type, lines, transfers){\r\n\tthis.transports[name] = new PmzTransport(name, name, { type: type }, lines || {}, transfers || {});\r\n};\r\n\r\nPmzModel.prototype.removeTransport = function(name){\r\n\tdelete this.transports[name];\r\n};\r\n\r\nPmzModel.prototype.getTransport = function(name){\r\n\treturn this.transports[name];\r\n};\r\n\r\nmodule.exports = PmzModel;\r\n\n},{\"./metadata\":7,\"./scheme\":10,\"./transport\":11}],9:[function(require,module,exports){\n'use strict';\r\n\r\nfunction PmzSchemeLine(id, name, color, labelColor, labelBackgroundColor, coords, rects, heights, rect, rects2, nodes, visible){\r\n\tthis.id = id;\r\n\tthis.name = name;\r\n\r\n\tthis.color = color;\r\n\tthis.labelColor = labelColor;\r\n\tthis.labelBackgroundColor = labelBackgroundColor;\r\n\tthis.coords = coords || [];\r\n\tthis.rects = rects || [];\r\n\tthis.heights = heights || [];\r\n\tthis.rect = rect;\r\n\tthis.rects2 = rects2 || [];\r\n\tthis.nodes = nodes || [];\r\n\tthis.visible = visible;\r\n\treturn this;\r\n}\r\n\r\nmodule.exports = PmzSchemeLine;\r\n\n},{}],10:[function(require,module,exports){\n'use strict';\r\n\r\nfunction PmzScheme(id, name, options, lines){\r\n\tthis.id = id;\r\n\tthis.name = name;\r\n\tthis.options = options;\r\n\tthis.lines = lines;\r\n\treturn this;\r\n}\r\n\r\nmodule.exports = PmzScheme;\r\n\n},{}],11:[function(require,module,exports){\n'use strict';\r\n\r\nfunction PmzTransport(id, name, options, lines, transfers){\r\n\tthis.id = id;\r\n\tthis.name = name;\r\n\tthis.options = options;\r\n\tthis.lines = lines;\r\n\tthis.transfers = transfers;\r\n\treturn this;\r\n}\r\n\r\nmodule.exports = PmzTransport;\r\n\n},{}],12:[function(require,module,exports){\n'use strict';\r\n\r\nvar PmzMetadata = require('../model/metadata');\r\n\r\nfunction load(ini){\r\n    var options = ini.Options;\r\n\r\n    var delayNames = (options['DelayNames'] || '').split('\\n');\r\n    return new PmzMetadata(\r\n        options.Name,\r\n        options.CityName,\r\n        options.Country,\r\n        options.NeedVersion,\r\n        options.MapAuthors.reduce(function(a, c) { return a + '\\n' + c; }),\r\n        options['Comment'],\r\n        delayNames);\r\n}\r\n\r\nfunction save(metadata){\r\n    var ini = { \r\n        Options: {\r\n            Name: metadata.name,\r\n            CityName: metadata.cityName || 'Unknown',\r\n            Country: metadata.countryName || 'Unknown',\r\n            NeedVersion: metadata.version || '1.0.0',\r\n            MapAuthors: (metadata.description || '').split('\\n'),\r\n        }\r\n    };\r\n    if(metadata.comment){\r\n        ini.Options.Comment = metadata.comment;\r\n    }\r\n    if(metadata.delays){\r\n        ini.Options.DelayNames = metadata.delays.reduce(function(a,c){ return a + ',' + c; });\r\n    }\r\n    return ini;\r\n}\r\n\r\nmodule.exports.load = load;\r\n\r\nmodule.exports.save = save;\r\n\n},{\"../model/metadata\":7}],13:[function(require,module,exports){\n(function (global){\n'use strict';\r\n\r\nvar JSZip = (typeof window !== \"undefined\" ? window['JSZip'] : typeof global !== \"undefined\" ? global['JSZip'] : null),\r\n    PmzUtils = require('../common/utils'),\r\n    PmzModel = require('../model/model'),\r\n    PmzMetadataFile = require('./metadata-file'),\r\n    PmzTransportFile = require('./transport-file'),\r\n    PmzSchemeFile = require('./scheme-file');\r\n\r\n\r\nfunction enumerateEntries(zip, ext, callback){\r\n    for(var entryName in zip.files){\r\n        var zipEntry = zip.files[entryName];\r\n        if(entryName.endsWith(ext)){\r\n            if(callback(entryName, zipEntry)){\r\n                return;\r\n            }\r\n        }\r\n    }        \r\n}\r\n\r\nfunction enumerateIniEntries(zip, ext, callback){\r\n    enumerateEntries(zip, ext, function(name, entry){\r\n        return callback(name, PmzUtils.parseIniText(\r\n            PmzUtils.decodeWindows1251(entry.asUint8Array())));\r\n    });\r\n}\r\n\r\nfunction openZip(file){\r\n    if(['application/x-zip-compressed', 'application/zip'].indexOf(file.type)==-1){\r\n        throw new TypeError('Invalid file type ' + file.type + ' for PMZ map');\r\n    }\r\n    var zip = new JSZip(file.content);\r\n    enumerateEntries(zip, '.pmz', function(name, entry){ \r\n        zip = new JSZip(entry.asArrayBuffer()); \r\n        return true;\r\n    });\r\n    return zip;\r\n}\r\n\r\nfunction load(file){\r\n\r\n    var zip = openZip(file);\r\n\r\n    var model = null;\r\n    enumerateIniEntries(zip, '.cty', function(name, ini){\r\n        model = new PmzModel(PmzMetadataFile.load(ini));\r\n    });\r\n\r\n    if(!model){\r\n        throw new TypeError('Invalid file format');\r\n    }\r\n\r\n    enumerateIniEntries(zip, '.trp', function(name, ini){\r\n        var transport = PmzTransportFile.load(ini, name, model.getMetadata());\r\n        model.addTransport(transport.name, transport.options, transport.lines, transport.transfers);\r\n    });\r\n\r\n    enumerateIniEntries(zip, '.map', function(name, ini){\r\n        var scheme = PmzSchemeFile.load(ini, name, model);\r\n        model.addScheme(scheme.name, scheme.options, scheme.lines);\r\n    });\r\n\r\n    return model;\r\n}\r\n\r\nfunction save(file, model){\r\n    var zip = openZip(file);\r\n    \r\n    var metaIni = PmzMetadataFile.save(model.metadata);\r\n    var metaText = PmzUtils.formatIniText(metaIni);\r\n    var metaEncoded = PmzUtils.encodeWindows1251(metaText);\r\n    zip.file(model.metadata.name + '.cty', metaEncoded);\r\n\r\n    file.content = zip.generate({type:'arraybuffer'});\r\n}\r\n\r\nmodule.exports.load = load;\r\n\r\nmodule.exports.save = save;\r\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"../common/utils\":5,\"../model/model\":8,\"./metadata-file\":12,\"./scheme-file\":14,\"./transport-file\":15}],14:[function(require,module,exports){\n'use strict';\r\n\r\nvar PmzUtils = require('../common/utils'),\r\n    PmzPoint = require('../common/point'),\r\n    PmzScheme = require('../model/scheme'),\r\n    PmzSchemeLine = require('../model/scheme-line'),\r\n    PmzAdditionNodes = require('../model/additional-nodes');\r\n\r\n\r\nfunction asAdditionalNodes(text){\r\n    var parts = asArray(text);\r\n\r\n    var line = parts[0];\r\n    var src = parts[1];\r\n    var dst = parts[2];\r\n    var isSpline = parts.length % 2 === 0;\r\n    var points = [];\r\n    for(var i=3;i<(parts.length-1); i+=2){\r\n        points.push(new PmzPoint(parseInt(parts[i]), parseInt(parts[i+1])));\r\n    }\r\n    return new PmzAdditionNodes(line, src, dst, points, isSpline);\r\n}\r\n\r\nfunction loadMapOptions(ini){\r\n    if(!ini){\r\n        return {};\r\n    }\r\n\r\n    return {\r\n        imageFileName: ini['ImageFileName'],\r\n        stationDiameter: ini['StationDiameter'],\r\n        lineWidth: ini['LinesWidth'],\r\n        upperCase: ini['UpperCase'],\r\n        wordWrap: ini['WordWrap'],\r\n        isVector: ini['IsVector'],\r\n        transports: PmzUtils.asArray(ini['Transports']),\r\n        checkedTransports: PmzUtils.asArray(ini['CheckedTransports'])\r\n    };\r\n}\r\n\r\nfunction loadAdditionalNodes(ini){\r\n    if(!ini){\r\n        return {};\r\n    }\r\n\r\n    var lineNodes = {};\r\n    for(var key in ini){\r\n        var item = ini[key];\r\n        var node = asAdditionalNodes(item);\r\n        if(!lineNodes[node.line]){\r\n            lineNodes[node.line] = [];\r\n        }\r\n        lineNodes[node.line].push(asAdditionalNodes(item));\r\n    }\r\n    return lineNodes;\r\n}\r\n\r\nfunction loadMapLines(ini, lineNodes){\r\n    var lines = {};\r\n    for(var key in ini){\r\n        var item = ini[key];\r\n\r\n        lines[key] = new PmzSchemeLine(key, key,\r\n            PmzUtils.asColor(item['Color']),\r\n            item['LabelsColor'],\r\n            item['LabelsBColor'],\r\n            PmzUtils.asPmzPointArray(item['Coordinates']),\r\n            PmzUtils.asPmzRectArray(item['Rects']),\r\n            PmzUtils.asFloatArray(item['Heights']),\r\n            PmzUtils.asPmzRect(item['Rect']),\r\n            PmzUtils.asPmzRectArray(item['Rects2']),\r\n            lineNodes[key] || [],\r\n            true );\r\n    }\r\n    return lines;\r\n}\r\n\r\nfunction filterLineSections(ini, model){\r\n    var lineNames = [];\r\n\r\n    model.getTransports().forEach(function(key){\r\n        Array.prototype.push.apply(lineNames, Object.keys(model.getTransport(key).lines));\r\n    });\r\n\r\n    var sections = {};\r\n    for(var key in ini){\r\n        if(lineNames.indexOf(key)!==-1) {\r\n            sections[key] = ini[key];\r\n        }\r\n    }      \r\n    return sections;  \r\n}\r\n\r\nfunction load(ini, name, model){\r\n    var options = loadMapOptions(ini['Options']);\r\n    var additionalNodes = loadAdditionalNodes(ini['AdditionalNodes']);\r\n    var lines = loadMapLines(filterLineSections(ini, model), additionalNodes);\r\n    return new PmzScheme(name, name, options, lines);\r\n}\r\n\r\nfunction save(){\r\n    throw new TypeError('Not implemented');\r\n}\r\n\r\nmodule.exports.load = load;\r\n\r\nmodule.exports.save = save;\r\n\r\n\r\n\n},{\"../common/point\":2,\"../common/utils\":5,\"../model/additional-nodes\":6,\"../model/scheme\":10,\"../model/scheme-line\":9}],15:[function(require,module,exports){\n'use strict';\r\n\r\nvar PmzTransportFile = (function(){\r\n\r\n    function loadTrpOptions(ini){\r\n        return {\r\n            type: ini['Type'] || 'Метро'\r\n        }\r\n    }\r\n\r\n    function loadTrpLines(cityDelays, ini){\r\n        var lines = {};\r\n        for(var key in ini){\r\n            var item = ini[key];\r\n\r\n            var delays = {};\r\n            if(item['Delays']){\r\n                var delayValues = item.Delays.split(',');\r\n                for(var i=0; i<cityDelays.length; i++){\r\n                    delays[cityDelays[i]] = delayValues[i];\r\n                }\r\n            }\r\n            if(item['DelayDay']){\r\n                delays['Day'] =  item.DelayDay;\r\n            }\r\n\r\n            if(item['DelayNight']){\r\n                delays['Night'] =  item.DelayNight;\r\n            }\r\n\r\n            lines[item.Name] = {\r\n                sectionName: key,\r\n                lineMap: item['LineMap'],\r\n                stations: item['Stations'],\r\n                driving: item['Driving'],\r\n                delays: delays\r\n            }            \r\n\r\n        }\r\n        return lines;\r\n    }\r\n\r\n    function loadTrpTransfers(ini){\r\n        return ini;\r\n    }\r\n\r\n    function filterTrpLineSections(ini){\r\n        var sections = {};\r\n        for(var key in ini){\r\n            if(['Options','Transfers','AdditionalInfo'].indexOf(key)===-1) {\r\n                sections[key] = ini[key];                    \r\n            }\r\n        }\r\n        return sections;\r\n    }\r\n\r\n    return {\r\n\t    load: function (ini, name, metadata){\r\n\t        return new PmzTransport(name, name, \r\n\t            loadTrpOptions(ini['Options'] || {}),\r\n\t            loadTrpLines(metadata.delays, filterTrpLineSections(ini)),\r\n\t            loadTrpTransfers(ini['Transfers']|| {}));\r\n\t    },\r\n\r\n        save: function(){\r\n            throw new TypeError('Not implemented');\r\n        }\r\n    };\r\n\r\n})();\r\n\r\n\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}